# Social Media Publisher - Multi-Sites & Multi-Comptes

SystÃ¨me multi-agents de publication automatisÃ©e de contenus sur rÃ©seaux sociaux utilisant LangGraph et Claude LLM.

## ğŸ¯ Objectif

"CrÃ©er une fois, diffuser partout" - gÃ©nÃ©ration automatisÃ©e de contenu adaptÃ© pour **plusieurs comptes** sur Twitter, Facebook, LinkedIn et Instagram, **gÃ©rÃ©s par sites web distincts**.

## ğŸ¢ Architecture Multi-Sites

### Sites Web SupportÃ©s
- **StuffGaming.fr** - Contenu gaming spÃ©cialisÃ©
- **Gaming.com** - ActualitÃ©s gaming gÃ©nÃ©rales
- **Football.com** - Contenu sportif football

### Comptes par Site (9 comptes total)
Chaque site dispose de **3 comptes** :
- ğŸ¦ **Twitter/X**
- ğŸ“˜ **Facebook**
- ğŸ“¸ **Instagram**

### Mapping Site + Plateforme â†’ Compte
```
stuffgaming.fr + instagram â†’ @stuffgaming_insta
gaming.com + twitter â†’ @gaming_twitter
football.com + facebook â†’ @football_fb
```

## ğŸ—ï¸ Architecture

### Composants principaux
- **API FastAPI** : Point d'entrÃ©e et orchestration
- **LangGraph** : Workflow multi-agents
- **Claude LLM** : GÃ©nÃ©ration et formatage de contenu
- **Celery** : Traitement asynchrone (Ã  venir)
- **ModÃ¨les Pydantic** : Validation des donnÃ©es

### Workflow
1. **GÃ©nÃ©ration** : Claude gÃ©nÃ¨re un contenu de base
2. **Formatage** : Adaptation pour chaque plateforme
3. **Publication** : Diffusion sur les rÃ©seaux (simulÃ©e)
4. **RÃ©sultats** : Consolidation des retours

## ğŸš€ Installation

### PrÃ©requis
- Python 3.9+
- ClÃ© API Anthropic (Claude)
- Redis (pour Celery, optionnel)

### Configuration

1. **Cloner et installer les dÃ©pendances**
```bash
pip install -r requirements.txt
```

2. **Configuration environnement**
```bash
cp .env.example .env
# Ã‰diter .env avec votre clÃ© API Anthropic
```

3. **Variables d'environnement minimales**
```env
ANTHROPIC_API_KEY="your_anthropic_api_key_here"
API_PORT=8090
CELERY_BROKER_URL="redis://localhost:6379/1"  # DB 1 pour Ã©viter conflits
DEBUG=true
```

## ğŸ§ª Tests

### Test de base
```bash
python test_orchestrator.py
```

### Test des fonctionnalitÃ©s avancÃ©es
```bash
python test_advanced_features.py
```

### Test multi-sites et multi-comptes â­ NOUVEAU
```bash
python test_multisite_features.py
```

### DÃ©marrage de l'API
```bash
python -m app.main
# Ou avec uvicorn:
uvicorn app.main:app --host 0.0.0.0 --port 8090 --reload
```

### Test validation compte
```bash
curl -X POST "http://localhost:8090/test/validate-account" \
  -d "site_web=stuffgaming.fr&platform=instagram"
```

## ğŸ“Š Endpoints API Multi-Sites

### Publication simple avec site web
```bash
curl -X POST "http://localhost:8090/publish" \
  -H "Content-Type: application/json" \
  -d '{
    "texte_source": "Nouveau guide gaming disponible !",
    "site_web": "stuffgaming.fr",
    "plateformes": ["twitter", "instagram", "facebook"],
    "hashtags": ["#gaming", "#guide"]
  }'
```

### Publication avancÃ©e avec images
```bash
curl -X POST "http://localhost:8090/publish/advanced" \
  -H "Content-Type: application/json" \
  -d '{
    "texte_source": "Top 5 des meilleurs jeux 2024",
    "site_web": "stuffgaming.fr",
    "platforms_config": [
      {
        "platform": "instagram",
        "content_type": "carousel",
        "nb_slides": 5,
        "hashtags": ["#top5", "#gaming"],
        "images_urls": [
          "https://s3.amazonaws.com/stuffgaming/game1.jpg",
          "https://s3.amazonaws.com/stuffgaming/game2.jpg"
        ]
      }
    ]
  }'
```

### Gestion des comptes
- **GET** `/accounts` - Liste tous les comptes
- **GET** `/accounts/{site_web}` - Comptes d'un site
- **GET** `/accounts/{site_web}/{platform}` - DÃ©tails compte spÃ©cifique
- **POST** `/test/validate-account` - Valider un compte

### Autres endpoints
- **GET** `/status/{request_id}` - Statut d'une demande
- **GET** `/examples` - Exemples avec sites web
- **POST** `/test/format/advanced` - Test formatage avec compte

## ğŸ¯ FonctionnalitÃ©s par plateforme

### Twitter
- âœ… **Posts** â‰¤ 280 caractÃ¨res
- âœ… Hashtags et mentions automatiques
- âœ… Ton direct et engageant

### Facebook
- âœ… **Posts** conviviaux
- âœ… Support liens et mÃ©dias
- âœ… Encouragement Ã  l'interaction

### LinkedIn
- âœ… **Posts** professionnels
- âœ… Contenu B2B optimisÃ©
- âœ… Hashtags sectoriels

### Instagram â­ NOUVEAU + IMAGES
- âœ… **Posts** avec lÃ©gendes accrocheuses + Ã©mojis
- âœ… **Stories** courtes (â‰¤50 caractÃ¨res) avec stickers
- âœ… **Carrousels** multi-slides (2-10 slides) **avec images S3**
- âœ… **GÃ©nÃ©ration auto d'images** si non fournies
- âœ… Hashtags et mentions intelligents

### Gestion des images carrousel
```json
{
  "texte_source": "Top 5 des jeux 2024...",
  "site_web": "stuffgaming.fr",
  "platforms_config": [{
    "platform": "instagram",
    "content_type": "carousel",
    "nb_slides": 5,
    "images_urls": [
      "https://s3.amazonaws.com/stuffgaming/game1.jpg",
      "https://s3.amazonaws.com/stuffgaming/game2.jpg"
    ]
  }]
}
```

**Si pas d'images** â†’ Appel automatique `generate_images()`

### Exemples multi-sites

#### StuffGaming - Contenu Gaming
```json
{
  "texte_source": "Nouveau Call of Duty disponible !",
  "site_web": "stuffgaming.fr",
  "platforms_config": [
    {"platform": "instagram", "content_type": "post"},
    {"platform": "twitter", "content_type": "post"}
  ]
}
```

#### Football.com - Story Instagram
```json
{
  "texte_source": "MbappÃ© au Real Madrid officiel !",
  "site_web": "football.com",
  "platforms_config": [{
    "platform": "instagram",
    "content_type": "story",
    "lien_sticker": "https://football.com/transfert"
  }]
}
```

## ğŸ”§ Structure du projet

```
app/
â”œâ”€â”€ main.py                 # API FastAPI
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ base.py            # ModÃ¨les de base
â”‚   â””â”€â”€ platforms.py       # ModÃ¨les par plateforme
â”œâ”€â”€ orchestrator/
â”‚   â””â”€â”€ workflow.py        # LangGraph workflow
â”œâ”€â”€ services/
â”‚   â””â”€â”€ llm_service.py     # Service Claude
â””â”€â”€ config/
    â””â”€â”€ settings.py        # Configuration
```

## ğŸ“ˆ Ã‰tat actuel

### âœ… Nouvellement implÃ©mentÃ© (Version 2.0)
- **ğŸ¢ SystÃ¨me multi-sites** : 3 sites web (StuffGaming, Gaming, Football)
- **ğŸ‘¥ Gestion multi-comptes** : 9 comptes (3 par site)
- **ğŸ¯ ParamÃ¨tre site_web obligatoire** : Identification automatique du compte
- **ğŸ–¼ï¸ Support images carrousel** : URLs S3 + gÃ©nÃ©ration automatique
- **ğŸ” Validation des comptes** : VÃ©rification existence et statut actif
- **ğŸ“Š API gestion comptes** : Endpoints dÃ©diÃ©s aux comptes
- **ğŸ§ª Tests multi-sites** : Validation complÃ¨te du systÃ¨me

### âœ… DÃ©jÃ  fonctionnel (Version 1.0)
- **Types spÃ©cifiques par plateforme** : Instagram story, carousel, etc.
- **API avancÃ©e** : `/publish/advanced` avec configurations granulaires
- **RÃ©trocompatibilitÃ©** : Ancien endpoint `/publish` avec site_web
- **Orchestrateur LangGraph** : Workflow multi-agents
- **GÃ©nÃ©ration Claude** : Contenu adaptÃ© par plateforme
- **Validation Pydantic** : ModÃ¨les complets pour tous types

### ğŸš§ En cours / Ã€ venir
- Agents de publication rÃ©els (APIs sociales)
- IntÃ©gration Celery pour l'asynchrone
- Base de donnÃ©es persistante avec historique
- Interface web de gestion des comptes
- Monitoring avancÃ© par site/compte

### ğŸ”§ Corrections apportÃ©es
- **Port API** : 8090 (configurable)
- **Redis** : DB 1 pour Ã©viter conflits
- **Site web obligatoire** : Toutes les requÃªtes incluent le site
- **Mapping comptes** : Association automatique site+plateformeâ†’compte
- **GÃ©nÃ©ration images** : Function placeholder pour carrousels

## ğŸ¯ Mapping Comptes ConfigurÃ©s

| Site Web | Instagram | Twitter | Facebook |
|----------|-----------|---------|----------|
| StuffGaming.fr | âœ… @stuffgaming_insta | âœ… @stuffgaming_twitter | âœ… @stuffgaming_fb |
| Gaming.com | âœ… @gaming_insta | âœ… @gaming_twitter | âœ… @gaming_fb |
| Football.com | âœ… @football_insta | âœ… @football_twitter | âœ… @football_fb |

**Total : 9 comptes actifs**

## ğŸ› ï¸ Prochaines Ã©tapes

1. **Agent de publication spÃ©cifique** - ImplÃ©menter un agent rÃ©el (ex: Twitter)
2. **IntÃ©gration Celery** - Traitement asynchrone distribuÃ©
3. **Tests avancÃ©s** - Tests d'intÃ©gration avec APIs
4. **Monitoring** - Logs et mÃ©triques de performance

## ğŸ“ Notes importantes

- **Publication simulÃ©e** : Les publications sont actuellement simulÃ©es
- **Stockage mÃ©moire** : Les tÃ¢ches sont stockÃ©es en mÃ©moire (non persistantes)
- **Authentification** : Les tokens API des rÃ©seaux sociaux ne sont pas encore utilisÃ©s

## ğŸ”‘ SÃ©curitÃ© & Configuration

### Variables d'environnement
```env
# Configuration API
API_PORT=8090
CELERY_BROKER_URL="redis://localhost:6379/1"

# LLM
ANTHROPIC_API_KEY="your_key_here"

# Tokens par site (exemple)
STUFFGAMING_INSTAGRAM_TOKEN="token_stuffgaming_ig"
GAMING_TWITTER_TOKEN="token_gaming_tw"
FOOTBALL_FACEBOOK_TOKEN="token_football_fb"
```

### SÃ©curitÃ© multi-comptes
- **Isolation des tokens** : Chaque site a ses propres clÃ©s API
- **Validation systÃ©matique** : VÃ©rification compte avant publication
- **Logs dÃ©taillÃ©s** : TraÃ§abilitÃ© par site et compte
- **DÃ©sactivation sÃ©lective** : Comptes activables/dÃ©sactivables individuellement

## ğŸ› ï¸ Prochaines Ã©tapes

1. **Agent publication Twitter** - ImplÃ©mentation avec API v2 âœ… PrioritÃ©
2. **Interface de gestion** - CRUD comptes via web UI
3. **Base de donnÃ©es** - Historique publications par site/compte
4. **Monitoring** - MÃ©triques performance par compte
5. **Auto-scaling** - Workers Celery distribuÃ©s

---

**Statut** : Version 2.0 - SystÃ¨me multi-sites et multi-comptes fonctionnel âœ…
**PrÃªt pour** : IntÃ©gration vraies APIs rÃ©seaux sociaux ğŸš€